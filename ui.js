Q.Box=function(a){this.options=a||{};this.enable=true};Q.Box.prototype={show:function(c,a){a=a||this.options;a.onclick=a.onclick||function(){};a.onclose=a.onclose||function(){};a.isEffect=Q.isUndefined(a.isEffect)?true:a.isEffect;a.isLoading=Q.isUndefined(a.isLoading)?true:a.isLoading;a.showClose=Q.isUndefined(a.showClose)?true:a.showClose;a.maskClick=Q.isUndefined(a.maskClick)?false:a.maskClick;a.id=a.id||"QBox";this.id=a.id;this.creat(a);var b=a.type||"string";b=b.toLowerCase();switch(b){case"ajax":this.showAjax(c,a);break;case"image":this.showImage(c,a);break;case"iframe":this.showIframe(c,a);break;case"string":default:this.showContent(c,a);break}return this},created:false,init:function(){var d=Q.alias("q");for(var a=0,e=d.length;a<e;a++){var c=d[a];var b=Q.attr(c,"q");if(Q.trim(b.toLowerCase()).indexOf("box")==0){Q.on(c,"click",this.launchHandle())}}},creat:function(a){if(!this.created){this.id=a.id;this.overlay=this.id+"Overlay";this.content=this.id+"Content";this.loadedContent=this.id+"LoadedContent";this.loadingGraphic=this.id+"LoadingGraphic";this.loadingOverlay=this.id+"LoadingOverlay";this.title=this.id+"Title";this.current=this.id+"Current";this.next=this.id+"Next";this.previous=this.id+"Previous";this.slideshow=this.id+"Slideshow";this.closeBtn=this.id+"CloseBtn";this.loadingTmp=this.id+"LoadingTmp";this.btnBar=this.id+"btnBar";this.width="550";this.height="400";this.appendHTML(a);this.addBindings(a);this.created=true}},appendHTML:function(e){var l=Q("#"+this.id);if(!l&&document.body){var g="display:none";var w=Q.tag;l=w("div",{id:this.id});l.style.cssText=g;var u=w("div",{id:this.overlay});u.style.cssText=(Q.ie==6)?"position:absolute;"+g:g;document.body.appendChild(u);var q=w("div",{id:this.content});var s=w("div",{id:this.loadedContent});s.style.cssText="width:0; height:0; overflow:hidden";q.appendChild(s);var h=w("div",{id:this.loadingGraphic});var c=w("div",{id:this.loadingOverlay});c.appendChild(h);q.appendChild(c);var x=w("div",{id:this.title});q.appendChild(x);var p=w("div",{id:this.current});q.appendChild(p);var o=w("div",{id:this.next});q.appendChild(o);var d=w("div",{id:this.previous});q.appendChild(d);var k=w("div",{id:this.slideshow});q.appendChild(k);var r=w("div",{id:this.closeBtn,style:"display:none"});q.appendChild(r);var a=w("div",{id:this.btnBar,style:"display:none"});var t=e.buttons;if(e.buttons){a.style.display="block";for(i in t){var n=t[i];var b=w("button");if(n.id){Q.attr(b,"id",n.id)}if(n.className){b.className=n.className}var m=n.callBack;if(m){for(j in m){Q.on(b,j,m[j])}}b.innerHTML=i;a.appendChild(b)}}q.appendChild(a);l.appendChild(q);var f=w("div",{id:this.id+"LoadingTmp"});f.style.cssText="position:absolute;visibility:hidden;left:0;top:0";document.body.appendChild(f);document.body.appendChild(l)}},addBindings:function(c){var e=Q("#"+this.id);var a=this;if(e){if(!this.inited){var f=Q("#"+this.closeBtn);Q.on(f,"click",this.closeBoxHandle(c));if(c.maskClick){var b=Q("#"+this.overlay);Q.on(b,"click",this.closeBoxHandle(c))}var d=Q("#"+this.content);Q.on(d,"click",function(g){Q.call(c.onclick)})}}},closeBox:function(a){var b=Q("#"+this.id);if(b){Q.hide("#"+this.overlay,"#"+this.id);if(a&&a.onclose){var c=a.onclose;Q.call(c)}}},closeBoxHandle:function(a){var b=this;return function(c){b.closeBox(a)}},launchHandle:function(){var a=this;return function(l){if(!a.enable){return}var g=Q.getEvent(l);var k=Q.getTarget(g);var f=k.tagName.toLowerCase();switch(f){case"a":Q.preventDefault(g);var c=Q.attr(k,"href");var d=Q.attr(k,"target");var h=Q.attr(k,"q");var b=Q.urlToJson(h);a.show(c,b);break;default:break}}},resetStyle:function(){},getLoadedContentOffset:function(b){var c={};var a=Q("#"+this.loadingTmp);c.w=parseInt(b.width||a.offsetWidth);c.h=parseInt(b.height||a.offsetHeight);return c},getContentOffset:function(a){var b={};b.w=0;b.h=0;var c=Q("#"+this.content);var g=Q("#"+this.loadedContent);function e(k,h){var l=parseInt(Q.css(k,h),10);return isNaN(l)?0:l}var f=["margin-left","margin-right","padding-left","padding-right","border-left-width","border-right-width"];var d=["margin-top","margin-bottom","padding-top","padding-bottom","border-top-width","border-bottom-width"];Q.each(f,function(l,h){b.w+=e(c,h);b.w+=e(g,h)});Q.each(d,function(l,h){b.h+=e(c,h);b.h+=e(g,h)});return b},setContentStyle:function(b){var c=Q("#"+this.content);var e=Q("#"+this.loadedContent);var a=Q("#"+this.loadingTmp);var d=Q("#"+this.title);c.style.cssText="";e.innerHTML=a.innerHTML;Q.show("#"+this.overlay,"#"+this.id);Q.hide("#"+this.loadingGraphic,"#"+this.loadingOverlay);Q.show("#"+this.title);e.style.cssText=Q.format("width:{0}px;height:{1}px;display:block",b.w,b.h);c.style.cssText="";a.innerHTML="";if(b.title){d.innerHTML=b.title}else{d.innerHTML=""}},showContentBox:function(b){var m=this;var f=Q("#"+this.loadingTmp);var q=Q("#"+this.content);var p=Q("#"+this.loadedContent);var g=Q("#"+this.loadingGraphic);var a=Q("#"+this.loadingOverlay);var y=this.title;var u=Q("#"+this.overlay);var n=Q("#"+this.id);var r=this.getLoadedContentOffset(b);b.w=r.w;b.h=r.h;var h=this.getContentOffset(b);var w=b.w+h.w;var c=b.h+h.h;function v(){m.setContentStyle(b)}if(b.isEffect){var t=Q.clientWidth();var e=Q.clientHeight();var x=document.body||document.documentElement;var d=Math.max(Math.floor(t/2-w/2),0);var l=Math.max(Math.floor(e/2-c/2)+x.scrollTop,0);var k=q.offsetWidth;var o=q.offsetHeight;function s(B){var A=k+(w-k)*B;var z=o+(c-o)*B;q.style.cssText=Q.format("height:{0}px;width{1}px",z,A)}Q.tween(this.id,{left:d,top:l,width:w,height:c},{duration:500,onComplete:v,onTween:s})}else{v();m.autoCenter(w,c)}},showLoadingBox:function(l){Q.hide("#"+this.title,"#"+this.current,"#"+this.next,"#"+this.previous,"#"+this.slideshow);if(!l.isLoading){return false}var k=this.width;var b=this.height;var g=Q.format;var d=Q("#"+this.loadedContent);d.style.cssText="width: 0px; height: 0px; overflow: hidden;";Q.show("#"+this.overlay,"#"+this.id,"#"+this.loadingGraphic,"#"+this.loadingOverlay);if(l.showClose){Q.show("#"+this.closeBtn)}Q("#"+this.content).style.cssText=g("width:{0}px;height:{1}px;",k,b);var f=Q.clientWidth();var c=Q.clientHeight();var a=Math.max(Math.floor(f/2-300/2),0);var e=Math.max(Math.floor(c/2-200/2),0);Q("#"+this.id).style.cssText=Q.format("left:{0}px;top:{1}px;width:300;height:200",a,e);this.autoCenter(k,b)},autoCenter:function(a,c){var d=Q("#"+this.id);var c=a||d.offsetHeight;var a=c||d.offsetWidth;var g=document.body||document.documentElement;var k=Q.clientWidth();var b=Q.clientHeight();var f=Math.max(Math.floor(k/2-a/2),0);var e=Math.max(Math.floor(b/2-c/2)+g.scrollTop,0);Q("#"+this.id).style.cssText=Q.format("left:{0}px;top:{1}px;",f,e)},showImage:function(b,a){a=a||{}},showAjax:function(b,a){a=a||{};var c=this;this.showLoadingBox(a);Q.ajax(b,{onSuccess:function(e){var d=e.responseText;if(d){if(Q.evalScripts){Q.evalScripts(d)}d=Q.stripTags?Q.stripTags(d,"script"):d;Q(c.loadingTmp).innerHTML=d;c.showContentBox(a);if(Q.evalScripts){Q.evalScripts(d)}}},onError:function(){alert("未知错误,请稍后重试！");c.closeBox()}})},showIframe:function(b,a){a=a||{}},showContent:function(b,a){this.showLoadingBox(a);Q("#"+this.loadingTmp).innerHTML=b;this.showContentBox(a)}};Q.alert=function(c,a){if(!this.box){this.box=new Q.Box()}var d=this;var a={};a.id="Qalert";a.title=null;a.showClose=false;a.maskClick=false;a.isEffect=false;a.buttons={"确定":{id:"QalertSubmit",className:"button green",callBack:{click:function(){d.box.closeBox()}}}};var b='<div id="QalertMessage">'+c+"</div>";return this.box.show(b,a)};Q.tip=function(c,a){if(!this.box){this.box=new Q.Box()}var d=this;var a={};a.id="Qalert";a.title=null;a.showClose=false;a.maskClick=false;a.isEffect=false;var b='<div id="QalertMessage">'+c+"</div>";return this.box.show(b,a)};Q.confirm=function(f,b,d){var e=new Q.Box();var a={};a.id="Qconfirm";a.title=null;a.showClose=false;a.maskClick=false;a.isEffect=false;a.buttons={"确定":{id:"QconfirmSubmit","class":"button green",callBack:{click:function(){e.closeBox();b&&b()}}},"取消":{id:"QconfirmCancel","class":"button blue",callBack:{click:function(){e.closeBox();d&&d()}}},};var c='<div id="QconfirmMessage">'+f+"</div>";return e.show(c,a)};